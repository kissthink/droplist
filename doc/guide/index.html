<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>droplist</title>
    <link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://docs.kissyui.com/1.4/source/guideline/templates/assets/com-prettify.css">
    <link rel="stylesheet" href="http://docs.kissyui.com/1.4/source/guideline/templates/assets/com.css">
    <script src="http://cdn.staticfile.org/jquery/2.1.1-rc2/jquery.min.js"></script>
    <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script src="http://cdn.staticfile.org/prettify/r298/prettify.min.js"></script>
    <script src="http://g.tbcdn.cn/kissy/k/1.4.8/seed-min.js" data-config="{combine:true}"></script>
  </head>
  <body data-spy="scroll" data-target=".bs-docs-sidebar">
    <div id="header"><a href="http://docs.kissyui.com/" class="logo">kissy</a>
      <nav><a href="http://docs.kissyui.com/1.4/docs/html/coms.html">优秀组件推荐</a></nav>
    </div>
    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span3 bs-docs-sidebar">
          <ul data-spy="affix" data-offset-top="0" class="nav nav-list bs-docs-sidenav"></ul>
        </div>
        <div class="span9 bs-docs-content">
          <h1 data-id="undefined" class="title">droplist</h1>
          <p class="author-wrapper"><span>组件有问题？旺旺联系作者：</span><a href="https://github.com/akecn" target="_blank" data-name="阿克" class="author"><img src="https://avatars.githubusercontent.com/u/352465?v=3&amp;s=60" alt="阿克"></a><span class="author-name">阿克</span>
          </p>
          <div class="common-link"><a href="../demo/index.html" target="_blank" class="demo">示例</a><a href="https://github.com/kissygalleryteam/droplist" target="_blank" class="source">源码</a></div>
          <p class="com-info"><span class="info-label">View</span><span data-com="droplist" class="J_View">1297</span></p>
          <p class="com-info"><span class="info-label">所属分类</span><a href="http://kpm.taobao.net/list/表单">表单</a><span class="info-label tag-label">组件标签</span><a href="http://kpm.taobao.net/list/tag?tag=droplist">droplist</a>
          </p>
          <p class="com-info"><span class="info-label">kissy版本</span><span>1.4.X</span>
          </p><h2 id="-">综述</h2>
<p>一个解决大数据列表渲染效率的下拉菜单组件。</p>
<ul>
<li>版本：2.0.1</li>
<li>作者：阿克 (wgk1987@gmail.com)</li>
<li>demo：<a href="http://kg.kissyui.com/droplist/2.0.1/demo/index.html">http://kg.kissyui.com/droplist/2.0.1/demo/index.html</a></li>
</ul>
<h2 id="-">快速使用</h2>
<pre>
    /**
     * 组件有很多渲染模式，最简单的是根据 select 元素渲染
     * 更多渲染方式参考 Demo 和 API 说明
     */
    S.use('kg/droplist/2.0.0/index', function (S, DropList) {
        // 根据 select 节点构造 droplist 对象
        var dl = DropList.decorate(elSelect);
        // 渲染结构和数据。
        dl.render();
    });
</pre>

<h2 id="-">参数详解</h2>
<pre>
KISSY.use('kg/droplist/2.0.0/index', function (S, DropList) {
    var droplist = new DropList({
        // 用于设置初始化的选择值。
        // 注意：默认选项的数据格式为text和value。允许有其他值，但内部只使用text作为展示文案，value为选项唯一的标识（选项对比依赖value值）。
        selectedItem: {
            text: "",
            value: ""
        },
        // 设置表单域的name值。该name值对应的表单域，会同步存储value值。
        fieldName: "selectName",
        /**
         * dataSource参数支持多种格式数据。
         * 1. 同步获取数据。
         *    1.1 直接传递数组。
         *    1.2 传入一个函数。该函数的第一个参数为callback，只需要将数据作为这个callback函数的第一个参数执行即可。
         * 2. 异步获取数据。
         *    2.1 传入一个url地址。向该地址发起请求，默认要求返回json数据，其list参数为实际的数组数据；result参数为true。
         *    2.2 传入一个plainObject对象，参照`KISSY.IO`的格式。
         */
        dataSource: {
            url: "./getlist3.html",
            // 默认就是json格式
            dataType: "json",
            // 设置异步请求的参数
            data: {
                parama: 1,
                paramb: 2
            }
        },
        /**
         * 搜索的异步条件。KISSY.IO的参数格式
         * 搜索的结果也会过fnReceive和fnDataAdapter函数。
         */
        remote: {
            url: "./search.html"
        },
        // 指定插入的位置。参数el为droplist对象的容器节点。
        insertion: function(el) {
            S.one(el).insertBefore($log);
        },
        // 通过对异步返回的数据进行调整。
        // 使得异步数据也满足约定的标准。
        // 主要是确保有result和list数据。
        // 这里不对列表项进行适配。
        fnReceive: function(dt) {
            var data = dt.data,
                result = data && data.length > 0;

            if(!result) {
                alert("您还没有创建数据");
            }

            return {
                result: result,
                list: data
            }
        },
        // 通过数据适配函数来调整异步获取的数据。
        // 使得列表项的数据结构符合约定的标准。
        fnDataAdapter: function(list) {
            var result = [];
            S.each(list, function(it) {
                result.push({
                    text: it.text,
                    value: it.id
                });
            });
            return result;
        }
    });

    // 注册change事件。当选择项发生变化时触发。
    // 注意：进行搜索的时候，默认会取消选项，即会触发change事件且ev.data值为undefined
    droplist.on('change', function(ev) {
        // 获取当前选项的数据。
        var data = ev.data
        console.log('current selected data is:', data);
    });

    // 对于同步设置的数据，在注册事件之前执行render()方法，不会触发初始值的change事件。
    // 对于异步获取数据，在注册事件前后执行都是会触发change事件。因为数据处理总是比render迟执行。
    droplist.render();
});
</pre>

<h2 id="api-">API说明</h2>
<h3 id="-">构造参数</h3>
<ul>
<li><p>cfg</p>
<ul>
<li>dataSource {Object}<ul>
<li>cfg 同KISSY.io的配置参数。默认dataType: &quot;json&quot;,type: &quot;GET&quot;</li>
</ul>
</li>
<li>fieldName {String}<ul>
<li>设置用来同步value值的隐藏域的name属性。</li>
</ul>
</li>
<li>insertion 用来决定如何将DropList容器对象插入文档中。<ul>
<li>{String} 目标容器的selector字符串。DropList对象会append到目标容器。</li>
<li>{Function} 第一个参数是DropList容器的节点对象。</li>
<li>{DOMElement} DOM元素，会直接append到该元素。</li>
</ul>
</li>
<li>fnDataAdapter {Function}<ul>
<li>对设置的列表选项数据进行适配处理。</li>
<li>return Array<Object> 返回的数组，每一项需要包含value和text属性，属性值是字符串类型数据，且value值是列表唯一的。</li>
</ul>
</li>
<li>fnReceive {Function}<ul>
<li>对异步返回的数据进行适配处理。</li>
<li>return {Object} 返回的数据需要包含result和list属性。若result为true，则表示数据返回成功，若result为false，则表示失败，默认会调用alert方法显示msg属性值；list为数据列表。</li>
</ul>
</li>
<li>hideDelay {Number}<ul>
<li>输入框失去焦点以后，隐藏列表的延迟时间。默认100ms。</li>
</ul>
</li>
<li>fieldName {String}<ul>
<li>用于同步选择项的value值的隐藏域的name属性。</li>
</ul>
</li>
<li>freedom {Boolean}<ul>
<li>在失去焦点时，若没有对应的选择项。则会将当前输入内容为text，默认-1为value进行存储。</li>
<li>text只是在input中展示，value将存储到elValue表单域中。</li>
</ul>
</li>
<li>autoMatch {Boolean}<ul>
<li>是否在失去焦点的时候自动根据当前输入值进行匹配。</li>
<li>若匹配到某一项的text与输入值一致，则设置该项为选中状态。</li>
</ul>
</li>
<li>emptyFormat {String | {Function}}<ul>
<li>定制搜索结果为空时展示的内容。</li>
<li>支持function，其返回的html作为内容显示。参数query为当前输入的搜索关键词</li>
<li>也支持纯字符串。字符串直接作为内容显示。</li>
</ul>
</li>
<li>droplistCls {String}<ul>
<li>droplist样式钩子</li>
</ul>
</li>
<li>mulSelect {Boolean}<ul>
<li>是否允许多选, 默认单选：false 。</li>
</ul>
</li>
<li>selectedItem {Object} | Array{Object}<ul>
<li>默认选中项。格式：{ value: &quot;4&quot;, text: &quot;option4&quot;}</li>
<li>如果mulSelect参数为true，允许多选, 则为Array{Object}数组对象;</li>
</ul>
</li>
<li>placeholder {String}<ul>
<li>设置占位符内容</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="-">静态方法</h3>
<ul>
<li><p>decorate 用于渲染select元素为DropList对象。</p>
<ul>
<li>调用方式<code>DropList.decorate(elSelect, cfg)</code></li>
<li>elSelect为要渲染的select元素。</li>
<li>cfg为构造参数。若与select元素的配置有冲突，会覆盖select上的配置信息（如fieldName）。</li>
<li>return {DropList Instance} 返回DropList实例对象。</li>
</ul>
</li>
<li><p>multiple 用于渲染json数据为多级联动的DropList对象。</p>
<ul>
<li>调用方式<code>DropList.multiple(cfg)</code></li>
<li>cfg为构造参数。<ul>
<li>参数dataSource: 数据源json。值类型：Array -&gt; Json</li>
<li>参数paramSubcat: 子选项的属性名。值类型：Array -&gt; Json</li>
<li>参数paramText: 作为选项显示内容的属性名。值类型：String</li>
<li>参数paramValue: 作为值的属性名。值类型：String OR Number</li>
<li>参数isDefault: 默认值的属性名。值类型：boolean   （选填）</li>
<li>参数subcatDeep: 默认显示子droplist的个数。值类型：Number  （选填）</li>
<li>参数isShowSub: subcatDeep设置了才生效，默认是否显示所有subDrop 值类型：boolean （选填）</li>
<li>参数subConfig: 子droplist配置。值类型：Array -&gt; Json  可配置参数：同上cfg</li>
</ul>
</li>
<li>return {mulDropList Instance} 返回多级DropList组合的联动对象。<ul>
<li>特有方法: doWith(index, value, fnMatch, fnMismatch);  index为多级的序号（0表示第一级）,其他参数同下doWith方法</li>
<li>特有事件: change 同下事件change</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="-">静态属性</h3>
<ul>
<li>NOT_FOUND_VALUE = -1<ul>
<li>配置了freedom时，输入项没有匹配，且设为当前选择项时的默认value值。</li>
</ul>
</li>
</ul>
<h3 id="-">属性</h3>
<ul>
<li>elWrap<ul>
<li>DropList对象的容器。列表浮层元素不包含在该容器中。</li>
</ul>
</li>
</ul>
<h3 id="-">方法</h3>
<ul>
<li><p>selectByValue(value)</p>
<ul>
<li>根据指定的value值选择选项。</li>
</ul>
</li>
<li><p>getDataByValue(value)</p>
<ul>
<li>根据指定的value获取对应的数据内容。</li>
<li>return 设置dataSource的完整的数据内容。</li>
<li>注意：包含其他内部使用的数据。建议对返回的数据只做读操作，不要覆盖原有的属性。</li>
</ul>
</li>
<li><p>getSelectedData</p>
<ul>
<li>获取当前选择项的数据内容</li>
<li>return 当前选中的数据。</li>
</ul>
</li>
<li><p>render</p>
<ul>
<li>初始化渲染结构。初始化获取和数据处理。</li>
<li>注意：设置同步数据时，若先render后注册change事件。则初始化的change事件不会触发。</li>
</ul>
</li>
<li><p>doWith(value, fnMatch, fnMismatch)</p>
<ul>
<li>判断当前选择值是否与value相匹配。</li>
<li>调用方法时会立即执行一次判断。</li>
<li>value 为列表中某一项的value值。</li>
<li>fnMatch 匹配时执行的处理逻辑</li>
<li>fnMismatch 不匹配时执行的处理逻辑</li>
</ul>
</li>
</ul>
<h3 id="-">事件</h3>
<ul>
<li>change<ul>
<li>当选择项发生变化时触发。其事件对象中包含的<code>data</code>数据为当前选择的数据。</li>
<li>当进行搜索操作的时候，会将当前选项清除。此时也会触发change事件。</li>
</ul>
</li>
</ul>
<h2 id="-">其他</h2>
<ul>
<li>键盘操作<ul>
<li>支持键盘操作。上下方向键控制聚焦操作，回车选择当前聚焦项。</li>
</ul>
</li>
</ul>

          <div style="display:none;"><script type="text/javascript" src="http://tajs.qq.com/stats?sId=36378479" charset="UTF-8"></script></div>
          <script src="http://docs.kissyui.com/1.4/source/guideline/templates/assets/com.js"></script>
        </div>
      </div>
    </div>
  </body>
</html>